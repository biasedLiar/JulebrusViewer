@page "/person"

@using BlazorApp1.Models
@using ClassLibrary1
@using BlazorApp1.Components.SubComponent
@inject IDataAccess _data
@inject IConfiguration _config
@attribute [StreamRendering]

<div class="ChoosePerson">

    <h3>Guessers</h3>

    @if (people.Count() == 0)
    {
        <p><em>Loading...</em></p>
    } else {
        <div class="ChoosePerson_PersonSummaryBoxGallery">
            @foreach (var p in people)
            {
                <a href="http://localhost:5178/kaffe">
                    <PersonSummaryBox class="PersonSummaryBox" personModel="p"></PersonSummaryBox>
                </a>
            }

        </div>
    }
</div>


@code {

    private List<ExpandedPersonModel> people = new List<ExpandedPersonModel>();

    protected override async Task OnInitializedAsync(){
        string sql = "select *, " + 
            "(select COUNT(*) from event_person WHERE event_person.person_id = person.id) as event_count, " + 
            "(select COUNT(*) from gjett WHERE gjett.person_id = person.id) as gjett_count " + 
            "from person";
        await Task.Delay(300);
        people = await _data.LoadData<ExpandedPersonModel, dynamic>(sql, new { }, _config.GetConnectionString("default")!);
            
    }
}